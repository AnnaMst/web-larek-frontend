# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Товар

```
interface IProduct {
    id?: string;
    description?: string;
    image?: string;
    title: string;
    category?: string;
    price: number;
}
```
Заказ
```
interface IOrder {
    payment: string;
    email: string;
    phone: string;
    address: string;
    total: number;
    items: [];
}
```
Данные о товаре, используемые в модуле товара
```
type TProductInfo = Pick<IProduct, 'description' | 'category' | 'image' | 'price' | 'title'>
```
Данные о заказе в попапе корзины пользователя
```
type TBasketInfo = Pick<IOrder, 'items' | 'total'>
```
Данные о заказе в форме об оплате и адресе
```
type TOrderInfo = Pick<IOrder, 'payment' | 'address'>
```
Данные о заказе в форме с контактами покупателя
```
type TUserInfo = Pick<IOrder, 'email' | 'phone'>
```
Данные о заказе в форме об успехе заказа
```
type TSuccessInfo = Pick<IOrder, 'total'>
```
## Архитектура приложения

Код приложения разделён на слои согласно парадигме MVP
1) слой представления: отвечает за отображение данных на странице
2) слой данных, отвечает за хранение и изменение данных
3) презентер, отвечает за связь представления и данных

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передаётся базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:
- 'get' - выполяет GET запрос на переданный в параметрах эндпоинт и возвращает промис с объектом, которым ответит сервер
- 'post' - пинимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные из эндпоинт, переданный как параметр при вызове метода. По умолчанию выполняется 'POST' запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс испротщуеися в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом 'IEvents':
- 'on' - подписка на событие
- 'emit' - инициализация события
- 'trigger' - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс ProductData
Класс отвечает за хранение и логику работы с товарами в магазине.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- _product: IProduct[] - массив объектов товаров
- _events: Ivents - экземпляр класса

Также класс предоставляет метод для работы с этими данными:
- getProductInfo(productId: string): TProductInfo; - метод, который возвращает основные данные карточки для отображения на сайте
- getProductItem(products: Iproduct[], productId: string): TProductInfo - метод, который возвращает 1 товар
- set products(): [] - сохранение массива товаров в классе
- getAllProducts(): IProduct[] - метод вывода всех товаров, которые есть в магазине

#### Класс OrderData
Класс отвечает за хранение и логику работы с заказом в магазине.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- payment: string; - метод оплаты товара
- email: string; - имейл пользователя
- phone: string; - номер телефона пользователя
- address: string; - адрес, введённый пользователем
- items: []; - массив id выбранных товаров

Также класс предоставляет метод для работы с этими данными:
- addProductToCart(productId: string): void - добавляет товары в корзину
- setProductsInfo(productMassive[]): void - сохраняет данные о товарах в корзине
- getProductsInfo(): { TProductInfo } - выводит список товаров в корзине
- getItem(productId: string): TProductInfo; - возвращает данные о том товаре, который пользователь добавил в корзину
- isProductInCart(productId: string): boolean - проверяет наличие товара в корзине
- deleteProduct(productId: string, payload: Function | null): void; - удаляет товары из корзины
- countTotal(productMassive: []): number | null; - считает сумму корзины
- setTotal(productTotal: number): void - сохраняет данные о сумме корзины
- getTotal(): number - получает данные о сумме корзины
- checkTotal(productMassive: []): boolean - проверяет, чтобы сумма корзины была больше 0
- choosePayment(paymentElement: HTMLButtonElement, payload: Function | null): void; - выбирает способ оплаты
- setPayment(paymentInfo: string): void - сохраняет информацию способе оплаты
- setUserData(email: string, phone: string, address: string): void - сохраняет данные пользователя в корзине
- getUserData(): { email: string; phone: string; address: string } - получает данные пользователя из корзины
- checkValidationOrder(data: Record<keyof TOrderInfo, string>): boolean; - проверяет правильность заполнения поля в форме заказа
- checkValidationUser(data: Record<keyof TUserInfo, string>): boolean; - проверяет правильность заполнения полей в форме данных пользователя

### Слой представления
Отвечает за отображения в контейнере (DOM элементе)

#### Абстрактный класс Component
Базовый компонент

- constructor(container: HTMLElement) - конструктор принимает DOM элемент

Методы класса:
- toggleClass(element: HTMLElement, className: string, force?: boolean) - переключатель классов
- setText(element: HTMLElement, value: unknown) - установка текстового содержимого
- render(data?: Partial`<T>`): HTMLElement - вернуть корневой элемент

#### Класс Page
Реализует главную страницу.

- constructor(container: HTMLElement, events: IEvents) - конструктор принимает DOM элемент и экземпляр класса 'EventEmitter' для возможности инициации событий

Поля класса:
- basketCounter: HTMLElement - отвечает за отрисовку счётчика товаров в корзине
- basket: HTMLElement - отвечает за отрисовку элемента корзины, на него будем вешать слушатель события
- catalogue: HTMLElement - отрисовывает товары

Методы класса:
- setBasketCounter(value: number): string - устанавливает счётчик товаров в корзине
- set catalog(items: HTMLElement[]): [] - выводит каталог на страницу

#### Класс Card
Отвечает за отображение карточки товара, задавая ей данные названия, категории, изображения, описания и цены. В конструктор класса передаётся DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователем генерируются соответствующие события\
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта, принимает экземпляр 'EventEmitter' для инициации событий.\

Методы класса:
- setData(cardData: IProduct): void - заполняет атрибуты элементов карточки данными
- render(): void - метод возвращает заполненную карточку со слушетелями
- get id: string - возвращаяет уникальный id карточки

#### Класс Modal
Реализует модальное окно

- constructor(container: HTMLElement, events: IEvents) - конструктор принимает DOM элемент и экземпляр класса 'EventEmitter' для возможности инициации событий

Поля класса:
- modal: HTMLElement - элемент модального окна
- closeButton: HTMLButtonElement - кнопка закрытия модального окна
- events: IEvents - брокер событий

Методы класса:
- open(): void - реализует открытие модального окна
- close(): void - реализует закрытие модального окна нажатием на кнопку закрытия и по клику вне модального окна
- render(data: HTMLElement): - реализует отрисовку модального окна

#### Класс Form
Родительский класс для всех форм для страницы.

- constructor(container: HTMLElement, events: IEvents) - конструктор принимает DOM элемент и экземпляр класса 'EventEmitter' для возможности инициации событий

Поля класса:
- submitButton - кнопка подтверждения
- _form: HTMLFormElement - элемент формы
- formName: string - значение атрибута name формы
- handleSubmit: Function - функция, на выполнение который запрашивается подтверждение
- inputs: NodeListOf`<HTMLInputElement>` - коллекция всех полей ввода
- error: HTMLElement - элемент для вывода ошибок в форме

Методы класса:
- render(data: HTMLElement): void - метод реализует отрисовку формы
- setValid(isValid: boolean): void - изменияет активность кнопки подтверждения
- getInputValues(): Record`<string, string>`- возвращает объект с данными из полей формы, где ключ - name инпута, значение - данные, введенные пользователем
- setInputValues(data: Record`<string, string>`): void - принимает объект с данными для заполнения полей формы
- setError(data: {field: string, value: string, validInformation: string}): void - принимает объект с данными для отображения или сокрытия текстов ошибок в поле ошибки
- showInputError(field: string, showMessage: string): void - отображает полученный текст ошибки в поле ошибки
- hideInputError(field: string): void - очищает текст ошибки в поле ошибки
- get form: HTMLElement - геттер для получения элемента формы
-  handleFormChange(): void - метод, отвечающий за вызов события изменения формы
- submitForm(): void - метод, отвечающий за сабмит формы

#### Класс OrderForm
Расширение класса Form, класс для формы заказа (выбор оплаты и ввод адреса).

- constructor(container: HTMLElement, events: IEvents) - конструктор принимает DOM элемент и экземпляр класса 'EventEmitter' для возможности инициации событий

Поля класса:
- onlinePaymentButton: HTMLElement - кнопка оплаты онлайн
- offlinePaymentButton: HTMLElement - кнопка оплаты наличными

Методы класса:
- managePayment(onlinePaymentButton: HTMLElement, offlinePaymentButton: HTMLElement): void - метод реализует выбор способа оплаты в форме
- handleFormChange(): void - метод расширяет родительский метод, отвечающий за вызов события изменения формы
- submitForm(): void - метод, отвечающий за сабмит формы: её сохранение и переключение на следующую форму

#### Класс ContactsForm
Расширение класса Form, класс для записи контактной информации (телефон и имейл)

- constructor(container: HTMLElement, events: IEvents) - конструктор принимает DOM элемент и экземпляр класса 'EventEmitter' для возможности инициации событий

Поля класса такие же, как и в родительском классе

Методы класса:
-  handleFormChange(): void - метод расширяет родительский метод, отвечающий за вызов события изменения формы
- submitForm(): void - метод, отвечающий за сабмит формы: её сохранения и далее переключение на страницу успеха с помощью цепочки событий

#### Класс Basket
Реализует отрисовку формы корзины и её работу

- constructor(container: HTMLElement, events: IEvents) - конструктор принимает DOM элемент и экземпляр класса 'EventEmitter' для возможности инициации событий

Поля класса:
- list: HTMLElement - список товаров в корзине
- total: HTMLElement - сумма товаров в корзине
- submitButton - кнопка подтверждения заказа

Методы класса:
- render(data: HTMLElement): void - метод реализует отрисовку списка товаров в корзине
- set items(items: HTMLElement[]): void - устанавливает данные товаров, содержащихся в корзине
- deleteItem(): void - метод для удаления товара из корзины

#### Класс Success
Реализует отрисовку формы успеха и её работу

- constructor(container: HTMLElement, events: IEvents) - конструктор принимает DOM элемент и экземпляр класса 'EventEmitter' для возможности инициации событий

Поля класса:
- total: number - сумма товаров в корзине

### Слой коммуникаций

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы, реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле 'index.ts', выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий, генерируемых с помощью брокера событий и обработчиков этих событий, описанных в 'index.ts'\
В 'index.ts' сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий

Список всех событий, которые могут генерироваться в системе\
Событие изменения данных (генерируется классами модели данных)
- 'cards:changed' - изменение массива карточек
- 'order:changed' - изменения в заказе


События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)
- 'modal:open' - открытие модального окна
- 'card:select' - выбор карточки для отображения в модальном окне
- 'cardButton:submit' - добавление товара в корзину
- 'basketItem:delete' - выбор товара в корзине для удаления
- 'basket:submit' - сохранение данных о заказанных товарах
- 'payment:submit' - событие, генерируемое при выборе способа оплаты в форме данных заказа
- 'order:input' - сохранение данных в форме данных заказа об адресе
- 'order:validation' - событие, сообщающее о необходимости валидации формы данных заказа об адресе
- 'contacts:input' - событие, сохранение данных в форме данных заказа о пользователе
- 'contacts:validation' - событие, сообщающее о необходимости валидации формы данных заказа о пользователе
- 'success:submit' - переход из модального окна успеха на главную страницу